<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EARWORM | Sales Conversation Analyzer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f8f9fa;
            color: #333;
        }
        
        .earworm-primary {
            background-color: #e83e8c;
        }
        
        .earworm-primary-text {
            color: #e83e8c;
        }
        
        .earworm-secondary {
            background-color: #6f42c1;
        }
        
        .earworm-gradient {
            background: linear-gradient(135deg, #e83e8c 0%, #6f42c1 100%);
        }
        
        .earworm-card {
            border-radius: 16px;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.06);
            transition: all 0.3s ease;
        }
        
        .earworm-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        .record-dot {
            display: inline-block;
            width: 16px;
            height: 16px;
            background-color: #e83e8c;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 1.5s ease infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(0.8); opacity: 0.8; }
            50% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(0.8); opacity: 0.8; }
        }
        
        .spinner {
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 3px solid rgba(232, 62, 140, 0.2);
            border-radius: 50%;
            border-top-color: #e83e8c;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .transcript-container {
            max-height: 400px;
            overflow-y: auto;
            scroll-behavior: smooth;
        }
        
        /* Audio visualization */
        .waveform {
            display: flex;
            align-items: center;
            height: 60px;
            gap: 3px;
        }
        
        .waveform-bar {
            width: 3px;
            background-color: rgba(232, 62, 140, 0.7);
            border-radius: 3px;
            transition: height 0.2s ease;
        }
        
        /* Logo animation */
        .logo-segment {
            fill: #e83e8c;
            transform-origin: center;
            transition: all 0.3s ease;
        }
        
        .logo-segment:hover {
            fill: #6f42c1;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(232, 62, 140, 0.5);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(232, 62, 140, 0.8);
        }
        
        /* Button animations */
        .animated-button {
            position: relative;
            overflow: hidden;
        }
        
        .animated-button:after {
            content: "";
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%);
            transform-origin: 50% 50%;
        }
        
        .animated-button:focus:not(:active)::after {
            animation: ripple 1s ease-out;
        }
        
        @keyframes ripple {
            0% {
                transform: scale(0, 0);
                opacity: 0.5;
            }
            20% {
                transform: scale(25, 25);
                opacity: 0.3;
            }
            100% {
                opacity: 0;
                transform: scale(40, 40);
            }
        }
    </style>
</head>
<body>
    <div class="flex h-screen overflow-hidden bg-gray-50">
        <!-- Sidebar -->
        <div class="w-64 h-full bg-white shadow-md transition-all duration-300 z-10">
            <div class="flex flex-col h-full">
                <!-- Logo -->
                <div class="p-6 flex items-center justify-center mb-6">
                    <div class="flex flex-col items-center">
                        <div class="logo-container w-40 h-16 mb-1">
                            <svg viewBox="0 0 200 60" xmlns="http://www.w3.org/2000/svg">
                                <g class="logo-worm">
                                    <path class="logo-segment" d="M30,30 C40,15 50,45 60,30" stroke-width="10" stroke="#e83e8c" fill="none" />
                                    <path class="logo-segment" d="M60,30 C70,15 80,45 90,30" stroke-width="10" stroke="#e83e8c" fill="none" />
                                    <path class="logo-segment" d="M90,30 C100,15 110,45 120,30" stroke-width="10" stroke="#e83e8c" fill="none" />
                                    <circle class="logo-segment" cx="25" cy="30" r="5" fill="#e83e8c" />
                                </g>
                                <text x="30" y="55" font-family="Poppins" font-weight="700" font-size="14" fill="#333">EARWORM</text>
                            </svg>
                        </div>
                        <span class="text-xs text-gray-500">Hear the Future.</span>
                    </div>
                </div>
                
                <!-- Navigation -->
                <nav class="flex-1 px-4 pb-4">
                    <div class="space-y-2">
                        <h3 class="text-xs font-semibold text-gray-500 uppercase tracking-wider">Main</h3>
                        <a href="#" class="flex items-center px-4 py-3 text-sm font-medium text-white rounded-lg earworm-gradient">
                            <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                            </svg>
                            Dashboard
                        </a>
                        <a href="#" class="flex items-center px-4 py-3 text-sm font-medium text-gray-700 rounded-lg hover:bg-gray-100">
                            <svg class="w-5 h-5 mr-3 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                            </svg>
                            Projects
                        </a>
                        <a href="#" class="flex items-center px-4 py-3 text-sm font-medium text-gray-700 rounded-lg hover:bg-gray-100">
                            <svg class="w-5 h-5 mr-3 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"></path>
                            </svg>
                            Library
                        </a>
                    </div>
                    
                    <div class="mt-8 space-y-2">
                        <h3 class="text-xs font-semibold text-gray-500 uppercase tracking-wider">Analysis</h3>
                        <a href="#" class="flex items-center px-4 py-3 text-sm font-medium text-gray-700 rounded-lg hover:bg-gray-100">
                            <svg class="w-5 h-5 mr-3 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                            </svg>
                            Metrics
                        </a>
                        <a href="#" class="flex items-center px-4 py-3 text-sm font-medium text-gray-700 rounded-lg hover:bg-gray-100">
                            <svg class="w-5 h-5 mr-3 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                            </svg>
                            Trends
                        </a>
                        <a href="#" class="flex items-center px-4 py-3 text-sm font-medium text-gray-700 rounded-lg hover:bg-gray-100">
                            <svg class="w-5 h-5 mr-3 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z"></path>
                            </svg>
                            Reports
                        </a>
                    </div>
                    
                    <div class="mt-8 space-y-2">
                        <h3 class="text-xs font-semibold text-gray-500 uppercase tracking-wider">Settings</h3>
                        <a href="#" class="flex items-center px-4 py-3 text-sm font-medium text-gray-700 rounded-lg hover:bg-gray-100">
                            <svg class="w-5 h-5 mr-3 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            </svg>
                            Settings
                        </a>
                        <a href="#" class="flex items-center px-4 py-3 text-sm font-medium text-gray-700 rounded-lg hover:bg-gray-100">
                            <svg class="w-5 h-5 mr-3 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                            </svg>
                            Account
                        </a>
                    </div>
                </nav>
                
                <!-- User profile -->
                <div class="p-4 border-t">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-gray-200 rounded-full overflow-hidden">
                            <svg class="w-full h-full text-gray-500" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 12a5 5 0 100-10 5 5 0 000 10zm0 2a8 8 0 00-8 8 1 1 0 001 1h14a1 1 0 001-1 8 8 0 00-8-8z"></path>
                            </svg>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm font-medium text-gray-900">Sarah Johnson</p>
                            <p class="text-xs text-gray-500">Sales Manager</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Main content -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <!-- Header -->
            <header class="bg-white shadow-sm z-10">
                <div class="px-6 py-4">
                    <div class="flex justify-between items-center">
                        <h1 class="text-2xl font-bold text-gray-800">Sales Conversation Analyzer</h1>
                        <div class="flex items-center space-x-4">
                            <button 
                                id="recordButton"
                                class="px-6 py-2.5 rounded-full font-medium text-white earworm-gradient shadow-lg animated-button transition-all duration-300 hover:shadow-xl flex items-center"
                            >
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path>
                                </svg>
                                Start Recording
                            </button>
                            <div id="recordingStatus" class="hidden items-center">
                                <span class="record-dot"></span> Recording... <span id="recordingTime" class="ml-1 font-medium">00:00</span>
                            </div>
                            <button 
                                id="processButton"
                                class="px-6 py-2.5 rounded-full font-medium text-white bg-gray-400 shadow animated-button transition-all duration-300 hover:shadow-lg opacity-50 cursor-not-allowed flex items-center"
                                disabled
                            >
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                                </svg>
                                Analyze Conversation
                            </button>
                            <div id="processingStatus" class="hidden items-center">
                                <span class="spinner"></span> Processing...
                            </div>
                        </div>
                    </div>
                </div>
            </header>
            
            <!-- Audio visualization -->
            <div id="waveformContainer" class="px-6 py-3 bg-white shadow-sm hidden">
                <div class="waveform" id="audioWaveform">
                    <!-- Waveform bars will be generated by JS -->
                </div>
                <div class="flex justify-between items-center mt-2">
                    <span id="currentTime" class="text-sm text-gray-500">00:00</span>
                    <div class="flex items-center space-x-4">
                        <button class="w-8 h-8 rounded-full flex items-center justify-center text-white earworm-primary">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"></path>
                            </svg>
                        </button>
                    </div>
                    <span id="totalTime" class="text-sm text-gray-500">00:00</span>
                </div>
            </div>
            
            <!-- Main Content -->
            <main class="flex-1 p-6 overflow-auto">
                <div class="grid grid-cols-12 gap-6">
                    <!-- Transcript Panel -->
                    <div class="col-span-6 bg-white rounded-lg shadow-sm earworm-card overflow-hidden">
                        <div class="p-4 border-b border-gray-100">
                            <h2 class="text-lg font-semibold text-gray-800">Conversation Transcript</h2>
                        </div>
                        <div id="transcript" class="p-4 transcript-container">
                            <p class="text-gray-500">Transcript will appear here after recording and analysis.</p>
                        </div>
                    </div>
                    
                    <!-- Sentiment Chart -->
                    <div class="col-span-6 bg-white rounded-lg shadow-sm earworm-card">
                        <div class="p-4 border-b border-gray-100">
                            <h2 class="text-lg font-semibold text-gray-800">Sentiment Trajectory</h2>
                        </div>
                        <div class="p-4" style="height: 300px;">
                            <canvas id="sentimentChart"></canvas>
                        </div>
                    </div>
                    
                    <!-- Topic Distribution -->
                    <div class="col-span-4 bg-white rounded-lg shadow-sm earworm-card">
                        <div class="p-4 border-b border-gray-100">
                            <h2 class="text-lg font-semibold text-gray-800">Topic Distribution</h2>
                        </div>
                        <div class="p-4" style="height: 250px;">
                            <canvas id="topicChart"></canvas>
                        </div>
                    </div>
                    
                    <!-- Pain Points -->
                    <div class="col-span-4 bg-white rounded-lg shadow-sm earworm-card">
                        <div class="p-4 border-b border-gray-100">
                            <h2 class="text-lg font-semibold text-gray-800">Pain Points</h2>
                        </div>
                        <div class="p-4" style="height: 250px;">
                            <canvas id="painPointsChart"></canvas>
                        </div>
                    </div>
                    
                    <!-- Budget Estimation -->
                    <div class="col-span-4 bg-white rounded-lg shadow-sm earworm-card">
                        <div class="p-4 border-b border-gray-100">
                            <h2 class="text-lg font-semibold text-gray-800">Budget Estimation</h2>
                        </div>
                        <div class="p-4" style="height: 250px;">
                            <div class="flex flex-col items-center justify-center h-full">
                                <div id="budgetTarget" class="text-4xl font-bold earworm-primary-text">
                                    $0
                                </div>
                                <div class="text-sm text-gray-500 mt-2">
                                    Estimated Target Budget
                                </div>
                                <div class="w-full mt-6 bg-gray-200 rounded-full h-4">
                                    <div 
                                        id="budgetProgressBar"
                                        class="earworm-gradient h-4 rounded-full" 
                                        style="width: 0%"
                                    ></div>
                                </div>
                                <div class="w-full flex justify-between text-xs mt-1">
                                    <span id="budgetMin">$0</span>
                                    <span id="budgetCurrent">Current: $0</span>
                                    <span id="budgetMax">$0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Key Insights -->
                    <div class="col-span-12 bg-white rounded-lg shadow-sm earworm-card">
                        <div class="p-4 border-b border-gray-100">
                            <h2 class="text-lg font-semibold text-gray-800">Key Insights</h2>
                        </div>
                        <div class="p-4">
                            <ul id="keyInsights" class="list-disc pl-6 space-y-2">
                                <li class="text-gray-500">Insights will appear here after analysis.</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM elements
            const recordButton = document.getElementById('recordButton');
            const processButton = document.getElementById('processButton');
            const recordingStatus = document.getElementById('recordingStatus');
            const recordingTime = document.getElementById('recordingTime');
            const processingStatus = document.getElementById('processingStatus');
            const transcriptContainer = document.getElementById('transcript');
            const waveformContainer = document.getElementById('waveformContainer');
            const audioWaveform = document.getElementById('audioWaveform');
            
            // State variables
            let mediaRecorder = null;
            let audioChunks = [];
            let isRecording = false;
            let recordingStartTime = 0;
            let timerInterval = null;
            let audioBlob = null;
            
            // Charts
            let sentimentChart = null;
            let topicChart = null;
            let painPointsChart = null;
            
            // Animation variables
            let waveformAnimation = null;
            
            // Initialize UI
            initializeUI();
            
            // Start/stop recording button
            recordButton.addEventListener('click', function() {
                if (isRecording) {
                    stopRecording();
                } else {
                    startRecording();
                }
            });
            
            // Process button
            processButton.addEventListener('click', function() {
                processConversation();
            });
            
            // Initialize UI elements
            function initializeUI() {
                // Create waveform bars
                createWaveform();
                
                // Initialize charts
                initializeCharts();
                
                // Animate logo parts
                animateLogo();
                
                // Add button ripple effect
                document.querySelectorAll('.animated-button').forEach(button => {
                    button.addEventListener('click', function(e) {
                        let x = e.clientX - e.target.getBoundingClientRect().left;
                        let y = e.clientY - e.target.getBoundingClientRect().top;
                        
                        let ripple = document.createElement('span');
                        ripple.classList.add('ripple');
                        ripple.style.left = `${x}px`;
                        ripple.style.top = `${y}px`;
                        
                        this.appendChild(ripple);
                        
                        setTimeout(() => {
                            ripple.remove();
                        }, 600);
                    });
                });
                
                // Animate cards on load
                animateCardsOnLoad();
            }
            
            // Create waveform visualization
            function createWaveform() {
                // Clear existing bars
                audioWaveform.innerHTML = '';
                
                // Add waveform bars
                for (let i = 0; i < 50; i++) {
                    const bar = document.createElement('div');
                    bar.className = 'waveform-bar';
                    bar.style.height = '3px';
                    audioWaveform.appendChild(bar);
                }
            }
            
            // Animate waveform
            function animateWaveform(isActive) {
                const bars = audioWaveform.querySelectorAll('.waveform-bar');
                
                if (isActive) {
                    // Cancel any existing animation
                    if (waveformAnimation) {
                        clearInterval(waveformAnimation);
                    }
                    
                    // Start new animation
                    waveformAnimation = setInterval(() => {
                        bars.forEach(bar => {
                            const height = Math.floor(Math.random() * 40) + 5;
                            bar.style.height = `${height}px`;
                        });
                    }, 100);
                } else {
                    // Stop animation
                    if (waveformAnimation) {
                        clearInterval(waveformAnimation);
                        waveformAnimation = null;
                    }
                    
                    // Reset bars to minimal height
                    bars.forEach(bar => {
                        bar.style.height = '3px';
                    });
                }
            }
            
            // Animate logo
            function animateLogo() {
                const logoSegments = document.querySelectorAll('.logo-segment');
                
                // Initial animation
                gsap.from(logoSegments, {
                    scale: 0.5,
                    opacity: 0,
                    duration: 1,
                    stagger: 0.1,
                    ease: "elastic.out(1, 0.3)"
                });
                
                // Add hover effects
                logoSegments.forEach(segment => {
                    segment.addEventListener('mouseenter', () => {
                        gsap.to(segment, {
                            scale: 1.2,
                            duration: 0.3,
                            ease: "power1.out"
                        });
                    });
                    
                    segment.addEventListener('mouseleave', () => {
                        gsap.to(segment, {
                            scale: 1,
                            duration: 0.3,
                            ease: "power1.out"
                        });
                    });
                });
            }
            
            // Animate cards on load
            function animateCardsOnLoad() {
                const cards = document.querySelectorAll('.earworm-card');
                
                gsap.from(cards, {
                    y: 50,
                    opacity: 0,
                    duration: 0.8,
                    stagger: 0.1,
                    ease: "power3.out"
                });
            }
            
            // Start recording
            async function startRecording() {
                try {
                    // Request microphone access
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    
                    // Reset audio chunks
                    audioChunks = [];
                    
                    // Set up media recorder
                    mediaRecorder = new MediaRecorder(stream);
                    
                    // Handle data available event
                    mediaRecorder.ondataavailable = function(event) {
                        audioChunks.push(event.data);
                    };
                    
                    // Handle recording stop
                    mediaRecorder.onstop = function() {
                        // Create audio blob
                        audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                        
                        // Stop all tracks
                        stream.getTracks().forEach(track => track.stop());
                        
                        // Show waveform container
                        waveformContainer.classList.remove('hidden');
                        waveformContainer.classList.add('flex', 'flex-col');
                        
                        // Stop waveform animation
                        animateWaveform(false);
                        
                        // Enable the process button with animation
                        processButton.disabled = false;
                        processButton.classList.remove('opacity-50', 'cursor-not-allowed', 'bg-gray-400');
                        processButton.classList.add('earworm-gradient');
                        
                        gsap.from(processButton, {
                            scale: 0.9,
                            duration: 0.5,
                            ease: "elastic.out(1, 0.3)",
                            onComplete: () => {
                                // Add a subtle pulse animation
                                gsap.to(processButton, {
                                    scale: 1.05,
                                    repeat: 2,
                                    yoyo: true,
                                    duration: 0.4,
                                    ease: "power1.inOut"
                                });
                            }
                        });
                    };
                    
                    // Start recording
                    mediaRecorder.start(1000); // Collect data every second
                    
                    // Start timer
                    recordingStartTime = Date.now();
                    timerInterval = setInterval(updateRecordingTime, 1000);
                    
                    // Update UI with animations
                    isRecording = true;
                    recordButton.innerHTML = `
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 10a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1v-4z"></path>
                        </svg>
                        Stop Recording
                    `;
                    
                    recordingStatus.classList.remove('hidden');
                    recordingStatus.classList.add('flex');
                    
                    // Show waveform and animate it
                    waveformContainer.classList.remove('hidden');
                    waveformContainer.classList.add('flex', 'flex-col');
                    animateWaveform(true);
                    
                    // Reset transcript and charts
                    transcriptContainer.innerHTML = '<p class="text-gray-500">Recording in progress...</p>';
                    resetCharts();
                    
                    // Animate record button
                    gsap.to(recordButton, {
                        backgroundColor: '#e83e8c',
                        backgroundImage: 'none',
                        duration: 0.3
                    });
                    
                } catch (err) {
                    console.error('Error accessing microphone:', err);
                    
                    // Show error toast
                    showToast('Error accessing microphone: ' + err.message, 'error');
                }
            }
            
            // Show toast notification
            function showToast(message, type = 'info') {
                // Create toast element
                const toast = document.createElement('div');
                toast.className = `fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg z-50 flex items-center text-white ${type === 'error' ? 'bg-red-500' : 'earworm-gradient'}`;
                
                // Add icon based on type
                const iconSvg = type === 'error' 
                    ? '<svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>'
                    : '<svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>';
                
                toast.innerHTML = iconSvg + message;
                
                // Add to document
                document.body.appendChild(toast);
                
                // Animate in
                gsap.fromTo(toast, 
                    { opacity: 0, y: -20 },
                    { opacity: 1, y: 0, duration: 0.3 }
                );
                
                // Remove after timeout
                setTimeout(() => {
                    gsap.to(toast, {
                        opacity: 0, 
                        y: -20, 
                        duration: 0.3,
                        onComplete: () => toast.remove()
                    });
                }, 5000);
            }
            
            // Stop recording
            function stopRecording() {
                if (mediaRecorder && isRecording) {
                    // Stop media recorder
                    mediaRecorder.stop();
                    
                    // Clear timer
                    clearInterval(timerInterval);
                    
                    // Update UI with animations
                    isRecording = false;
                    recordButton.innerHTML = `
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path>
                        </svg>
                        Start New Recording
                    `;
                    
                    // Restore button styling
                    gsap.to(recordButton, {
                        backgroundImage: 'linear-gradient(135deg, #e83e8c 0%, #6f42c1 100%)',
                        duration: 0.3
                    });
                    
                    recordingStatus.classList.add('hidden');
                    recordingStatus.classList.remove('flex');
                    
                    // Update transcript with animation
                    transcriptContainer.innerHTML = '<p class="text-gray-500">Recording complete. Click "Analyze Conversation" to process.</p>';
                    
                    // Show success toast
                    showToast('Recording completed successfully!');
                }
            }
            
            // Update recording time display
            function updateRecordingTime() {
                const elapsedSeconds = Math.floor((Date.now() - recordingStartTime) / 1000);
                const minutes = Math.floor(elapsedSeconds / 60).toString().padStart(2, '0');
                const seconds = (elapsedSeconds % 60).toString().padStart(2, '0');
                recordingTime.textContent = `${minutes}:${seconds}`;
                
                // Update current time display in waveform
                document.getElementById('currentTime').textContent = `${minutes}:${seconds}`;
                
                // Update total time in waveform
                document.getElementById('totalTime').textContent = `${minutes}:${seconds}`;
            }
            
            // Process the conversation
            async function processConversation() {
                if (!audioBlob) {
                    showToast('No recording available. Please record a conversation first.', 'error');
                    return;
                }
                
                // Show processing status with animation
                processingStatus.classList.remove('hidden');
                processingStatus.classList.add('flex');
                
                processButton.disabled = true;
                processButton.classList.add('opacity-50', 'cursor-not-allowed');
                processButton.classList.remove('earworm-gradient');
                processButton.classList.add('bg-gray-400');
                
                transcriptContainer.innerHTML = '<p class="text-gray-500">Processing audio...</p>';
                
                // Simulate a loading state for the cards
                const cards = document.querySelectorAll('.earworm-card');
                cards.forEach(card => {
                    card.style.opacity = '0.7';
                    card.style.pointerEvents = 'none';
                });
                
                try {
                    // Create form data
                    const formData = new FormData();
                    formData.append('audio', audioBlob, 'recording.webm');
                    
                    // Send to make.com (or simulate for demo)
                    const makeWebhookUrl = 'https://hook.us2.make.com/pj83qpi1fbz2eo7jhe0x3c317b8vuhta';
                    
                    // For demo purposes, we'll simulate the response
                    // In a real app, you would use the commented-out fetch code
                    /*
                    const response = await fetch(makeWebhookUrl, {
                        method: 'POST',
                        body: formData
                    });
                    
                    // Check response
                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }
                    
                    // Parse response
                    const data = await response.json();
                    */
                    
                    // Simulate API delay
                    await new Promise(resolve => setTimeout(resolve, 3000));
                    
                    // Mock data for demo
                    const data = {
                        transcript: [
                            {
                                speaker: "Salesperson",
                                text: "Hello there! Thanks for stopping by our dealership today. I understand you're interested in our new SUV models?",
                                timestamp: 1000,
                                sentiment: 0.7
                            },
                            {
                                speaker: "Customer",
                                text: "Yes, I'm looking for something that's good for a family of four with decent cargo space, but I'm really concerned about the safety features and reliability.",
                                timestamp: 8000,
                                sentiment: 0.2
                            },
                            {
                                speaker: "Salesperson",
                                text: "Safety is definitely a priority for family vehicles. Our SUV line has earned top safety ratings across the board. The XC model in particular has advanced driver assistance, automatic emergency braking, and a 360-degree camera system.",
                                timestamp: 18000,
                                sentiment: 0.8
                            },
                            {
                                speaker: "Customer",
                                text: "That sounds promising. What about fuel efficiency? Gas prices are really getting high, and I have a pretty long commute to work.",
                                timestamp: 30000,
                                sentiment: 0.4
                            },
                            {
                                speaker: "Salesperson",
                                text: "Great question. The XC model gets about 28 MPG combined city/highway, which is excellent for its class. We also have a hybrid option that pushes that up to 38 MPG if fuel efficiency is a top priority for you.",
                                timestamp: 40000,
                                sentiment: 0.7
                            },
                            {
                                speaker: "Customer",
                                text: "The hybrid sounds interesting, but I'm worried about the price. What's the difference in cost between the standard and hybrid models?",
                                timestamp: 52000,
                                sentiment: -0.2
                            },
                            {
                                speaker: "Salesperson",
                                text: "The hybrid is about $4,000 more than the standard model, but it qualifies for a $2,500 tax credit. Plus, you'll save approximately $800-$1,000 per year on fuel costs based on your commute, so the break-even point is pretty quick.",
                                timestamp: 64000,
                                sentiment: 0.6
                            },
                            {
                                speaker: "Customer",
                                text: "That's not as bad as I thought. What about warranty coverage? I had issues with my last vehicle that weren't covered.",
                                timestamp: 78000,
                                sentiment: 0.3
                            },
                            {
                                speaker: "Salesperson",
                                text: "We offer a comprehensive 5-year/60,000-mile bumper-to-bumper warranty, and the hybrid components are covered for 10 years/100,000 miles. We also include 3 years of free maintenance for oil changes and routine service.",
                                timestamp: 88000,
                                sentiment: 0.9
                            },
                            {
                                speaker: "Customer",
                                text: "That's reassuring. I think I'd like to see the hybrid model. What colors do you have available? And would it be possible to take it for a test drive today?",
                                timestamp: 100000,
                                sentiment: 0.8
                            }
                        ],
                        sentimentTrajectory: [
                            { time: 1000, salesperson: 0.7, customer: 0.5 },
                            { time: 10000, salesperson: 0.7, customer: 0.2 },
                            { time: 20000, salesperson: 0.8, customer: 0.3 },
                            { time: 30000, salesperson: 0.8, customer: 0.4 },
                            { time: 40000, salesperson: 0.7, customer: 0.4 },
                            { time: 50000, salesperson: 0.7, customer: -0.2 },
                            { time: 60000, salesperson: 0.6, customer: -0.1 },
                            { time: 70000, salesperson: 0.7, customer: 0.2 },
                            { time: 80000, salesperson: 0.8, customer: 0.3 },
                            { time: 90000, salesperson: 0.9, customer: 0.6 },
                            { time: 100000, salesperson: 0.9, customer: 0.8 }
                        ],
                        topicDistribution: [
                            { name: "Safety Features", value: 25 },
                            { name: "Fuel Efficiency", value: 20 },
                            { name: "Price/Budget", value: 30 },
                            { name: "Warranty", value: 15 },
                            { name: "Performance", value: 10 }
                        ],
                        painPoints: [
                            { category: "Cost Concerns", score: 8 },
                            { category: "Previous Bad Experience", score: 7 },
                            { category: "Fuel Economy", score: 6 },
                            { category: "Safety Worries", score: 5 }
                        ],
                        budgetEstimation: {
                            min: 35000,
                            max: 45000,
                            target: 40000,
                            current: 38000
                        },
                        keyInsights: [
                            "Customer is budget-conscious but willing to invest in the right vehicle with proper justification",
                            "Previous negative warranty experience is a significant concern that was addressed successfully",
                            "Safety features are a major priority due to family considerations",
                            "Fuel efficiency is important because of customer's long commute",
                            "Customer's sentiment improved significantly when warranty details were explained",
                            "There's high interest in the hybrid model if the ROI makes sense"
                        ]
                    };
                    
                    console.log('Analysis response:', data);
                    
                    // Update the dashboard with animation
                    updateDashboard(data);
                    
                } catch (error) {
                    console.error('Error processing audio:', error);
                    transcriptContainer.innerHTML = `<p class="text-red-500">Error: ${error.message}</p>`;
                    
                    // Show error toast
                    showToast('Error processing audio: ' + error.message, 'error');
                } finally {
                    // Hide processing status
                    processingStatus.classList.add('hidden');
                    processingStatus.classList.remove('flex');
                    
                    processButton.disabled = false;
                    processButton.classList.remove('opacity-50', 'cursor-not-allowed', 'bg-gray-400');
                    processButton.classList.add('earworm-gradient');
                    
                    // Restore cards
                    cards.forEach(card => {
                        card.style.opacity = '1';
                        card.style.pointerEvents = 'auto';
                    });
                }
            }
            
            // Update dashboard with analysis data
            function updateDashboard(data) {
                // Update transcript with animation
                updateTranscript(data.transcript || []);
                
                // Update sentiment chart with animation
                updateSentimentChart(data.sentimentTrajectory || []);
                
                // Update topic distribution with animation
                updateTopicChart(data.topicDistribution || []);
                
                // Update pain points with animation
                updatePainPointsChart(data.painPoints || []);
                
                // Update budget estimation with animation
                updateBudgetEstimation(data.budgetEstimation || {
                    min: 0,
                    max: 0,
                    target: 0,
                    current: 0
                });
                
                // Update key insights with animation
                updateKeyInsights(data.keyInsights || []);
                
                // Show success toast
                showToast('Analysis completed successfully!');
            }
            
            // Update transcript display
            function updateTranscript(transcript) {
                if (!transcript || transcript.length === 0) {
                    transcriptContainer.innerHTML = '<p class="text-gray-500">No transcript data available.</p>';
                    return;
                }
                
                // Clear container
                transcriptContainer.innerHTML = '';
                
                // Create transcript entries with staggered animation
                transcript.forEach((entry, index) => {
                    const entryElement = document.createElement('div');
                    entryElement.className = 'mb-4 opacity-0';
                    
                    const speakerElement = document.createElement('div');
                    speakerElement.className = `font-semibold ${entry.speaker === 'Salesperson' ? 'earworm-primary-text' : 'text-green-600'} flex items-center`;
                    
                    // Format timestamp as MM:SS
                    const minutes = Math.floor(entry.timestamp / 1000 / 60);
                    const seconds = Math.floor((entry.timestamp / 1000) % 60).toString().padStart(2, '0');
                    
                    // Add icon based on speaker
                    const iconSvg = entry.speaker === 'Salesperson' 
                        ? '<svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path></svg>'
                        : '<svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>';
                    
                    speakerElement.innerHTML = `${iconSvg}${entry.speaker} <span class="ml-2 text-gray-400 text-xs">(${minutes}:${seconds})</span>`;
                    
                    const textElement = document.createElement('div');
                    textElement.className = 'mt-1 text-gray-700';
                    textElement.innerHTML = highlightKeywords(entry.text);
                    
                    // Add sentiment indicator
                    const sentimentElement = document.createElement('div');
                    sentimentElement.className = 'mt-1 flex items-center';
                    
                    const sentimentColor = getSentimentColor(entry.sentiment);
                    const sentimentLabel = getSentimentLabel(entry.sentiment);
                    
                    sentimentElement.innerHTML = `
                        <div class="text-xs mr-2">Sentiment:</div>
                        <div class="w-16 h-2 bg-gray-200 rounded-full">
                            <div class="h-2 rounded-full" style="width: ${(entry.sentiment + 1) * 50}%; background-color: ${sentimentColor};"></div>
                        </div>
                        <div class="text-xs ml-2" style="color: ${sentimentColor};">${sentimentLabel}</div>
                    `;
                    
                    entryElement.appendChild(speakerElement);
                    entryElement.appendChild(textElement);
                    entryElement.appendChild(sentimentElement);
                    transcriptContainer.appendChild(entryElement);
                    
                    // Animate entry
                    gsap.to(entryElement, {
                        opacity: 1,
                        y: 0,
                        duration: 0.5,
                        delay: index * 0.1,
                        ease: "power2.out",
                        from: { opacity: 0, y: 20 }
                    });
                });
                
                // Scroll to top with animation
                gsap.to(transcriptContainer, {
                    scrollTop: 0,
                    duration: 0.5,
                    ease: "power2.out"
                });
            }
            
            // Get sentiment color based on value
            function getSentimentColor(sentiment) {
                if (sentiment >= 0.5) return '#10b981'; // Green
                if (sentiment >= 0) return '#60a5fa';  // Blue
                if (sentiment >= -0.5) return '#f59e0b'; // Yellow
                return '#ef4444'; // Red
            }
            
            // Get sentiment label based on value
            function getSentimentLabel(sentiment) {
                if (sentiment >= 0.5) return 'Positive';
                if (sentiment >= 0) return 'Neutral+';
                if (sentiment >= -0.5) return 'Neutral-';
                return 'Negative';
            }
            
            // Highlight keywords in text
            function highlightKeywords(text) {
                const keywords = ['budget', 'concerned', 'reliability', 'safety', 'features', 'test drive', 'price', 'cost', 'warranty', 'financing', 'payments', 'hybrid', 'fuel', 'efficiency'];
                
                // Create a regular expression to match all keywords (case insensitive)
                const regex = new RegExp(`\\b(${keywords.join('|')})\\b`, 'gi');
                
                // Replace keywords with highlighted version
                return text.replace(regex, '<span class="font-bold earworm-primary-text">$1</span>');
            }
            
            // Initialize charts
            function initializeCharts() {
                // Set Chart.js defaults
                Chart.defaults.color = '#64748b';
                Chart.defaults.font.family = "'Poppins', sans-serif";
                
                // Sentiment Chart
                const sentimentCtx = document.getElementById('sentimentChart').getContext('2d');
                sentimentChart = new Chart(sentimentCtx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [
                            {
                                label: 'Salesperson',
                                data: [],
                                borderColor: '#e83e8c',
                                backgroundColor: 'rgba(232, 62, 140, 0.1)',
                                tension: 0.4,
                                fill: true,
                                pointBackgroundColor: '#e83e8c',
                                pointRadius: 4,
                                pointHoverRadius: 6
                            },
                            {
                                label: 'Customer',
                                data: [],
                                borderColor: '#10b981',
                                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                tension: 0.4,
                                fill: true,
                                pointBackgroundColor: '#10b981',
                                pointRadius: 4,
                                pointHoverRadius: 6
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        animation: {
                            duration: 2000,
                            easing: 'easeOutQuart'
                        },
                        scales: {
                            y: {
                                min: -1,
                                max: 1,
                                title: {
                                    display: true,
                                    text: 'Sentiment'
                                },
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.05)'
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Time (seconds)'
                                },
                                grid: {
                                    display: false
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    boxWidth: 12,
                                    usePointStyle: true,
                                    pointStyle: 'circle'
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(255, 255, 255, 0.9)',
                                titleColor: '#333',
                                bodyColor: '#333',
                                borderColor: '#e1e1e1',
                                borderWidth: 1,
                                padding: 10,
                                displayColors: true,
                                mode: 'index',
                                intersect: false
                            }
                        },
                        interaction: {
                            mode: 'index',
                            intersect: false
                        }
                    }
                });
                
                // Topic Distribution Chart
                const topicCtx = document.getElementById('topicChart').getContext('2d');
                topicChart = new Chart(topicCtx, {
                    type: 'doughnut',
                    data: {
                        labels: [],
                        datasets: [{
                            data: [],
                            backgroundColor: ['#e83e8c', '#6f42c1', '#20c997', '#fd7e14', '#6610f2'],
                            borderColor: '#fff',
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        animation: {
                            animateRotate: true,
                            animateScale: true,
                            duration: 2000,
                            easing: 'easeOutQuart'
                        },
                        plugins: {
                            legend: {
                                position: 'right',
                                labels: {
                                    boxWidth: 12,
                                    usePointStyle: true,
                                    pointStyle: 'circle',
                                    padding: 15
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(255, 255, 255, 0.9)',
                                titleColor: '#333',
                                bodyColor: '#333',
                                borderColor: '#e1e1e1',
                                borderWidth: 1,
                                padding: 10,
                                displayColors: true
                            }
                        },
                        cutout: '65%'
                    }
                });
                
                // Pain Points Chart
                const painPointsCtx = document.getElementById('painPointsChart').getContext('2d');
                painPointsChart = new Chart(painPointsCtx, {
                    type: 'bar',
                    data: {
                        labels: [],
                        datasets: [{
